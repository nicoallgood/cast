<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shop Digital Signage</title>
    <!-- Load Google Fonts: Oswald for titles and banner; Montserrat for content -->
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@600&family=Montserrat:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        /* Approximate Pantone colors */
        --pantone471: #d4bfaa; /* Light beige */
        --pantone4635: #7e6756; /* Rich brown */
      }
      html,
      body {
        margin: 0;
        padding: 0;
        background: var(--pantone471);
        font-family: "Montserrat", sans-serif;
        color: var(--pantone4635);
        overflow: hidden;
      }
      /* Container for slides (leaving room for the banner) */
      #slides {
        position: relative;
        width: 100%;
        height: calc(100vh - 140px);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* Each slide occupies the container; only the active one is visible */
      .slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1s;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
      }
      .slide.active {
        opacity: 1;
      }
      /* Additional class for image slides with dark background */
      .image-slide {
        background-color: #000;
      }
      /* Styles for text slides */
      .slide .title {
        position: absolute;
        top: 40px; /* Increased spacing */
        left: 20px;
        font-family: "Oswald", sans-serif;
        font-size: 72px;
        font-weight: 600;
        text-align: left;
        width: calc(100% - 40px);
      }
      .content {
        position: absolute;
        top: 50%;
        width: 900px;
        font-size: 96px;
        font-weight: 300;
        text-align: center;
        transform: translateY(-50%);
        display: block;
        height: 300px; /* Set this to a fixed value that works for your design */
        overflow: hidden;
      }

      .fitme {
        display: block;
        width: 900px; /* or the fixed width you need */
        height: 300px; /* or the fixed height you need */
        overflow: hidden;
      }

      /* New styling for the sidenote (for text slides) */
      .slide .sidenote {
        position: absolute;
        bottom: 20px;
        right: 20px;
        font-size: 44px; /* Same as date font size */
        text-align: right;
      }

      /* Banner at the bottom for date/time and weather */
      #banner {
        position: relative;
        width: 100%;
        height: 140px;
        background: #fff;
        color: var(--pantone4635);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        box-sizing: border-box;
        border-top: 5px solid var(--pantone4635);
        font-family: "Oswald", sans-serif;
      }
      /* Force the center section to be exactly centered */
      #bannerCenter {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
      }

      #bannerCenter > #bannerTime {
        font-size: 74px;
        line-height: 1.2;
      }

      /* Banner sections for left and right remain in the document flow */
      #bannerLeft,
      #bannerRight {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      /* Banner left: only date (big font) */
      #bannerLeft > #bannerDate {
        font-size: 64px;
        line-height: 1.2;
        transition: opacity 0.5s ease;
      }
      /* Banner right: arrange as two columns for weather summary */
      #bannerRight {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
      }
      #bannerRight .ascii {
        margin-right: 10px;
        font-size: 24px;
        font-family: monospace;
        line-height: 1.1;
        white-space: pre;
      }
      #bannerRight .summary {
        text-align: left;
        font-size: 40px;
        line-height: 1.4;
      }
      /* Additional smaller text for temperature range and units */
      .tempRange,
      .small {
        font-size: 32px;
      }
      .moon {
        font-size: 32px;
        margin-left: 10px;
      }
      .arrow {
        font-family: "Roboto Condensed", sans-serif;
        font-size: 0.5em; /* Adjust as needed */
      }
      .blinkColon {
        display: inline-block;
        width: 0.6ch;
        text-align: center;
      }
      /* For image slides: full height, auto width */
      .image-slide img {
        height: 100%;
        width: auto;
      }
      /* General image style */
      img {
        display: block;
        margin: auto;
        object-fit: contain;
      }
    </style>
  </head>
  <body>
    <!-- Container for slides -->
    <div id="slides"></div>
    <!-- Banner for date/time and weather -->
    <div id="banner">
      <div id="bannerLeft">
        <div id="bannerDate"></div>
      </div>
      <div id="bannerCenter">
        <div id="bannerTime"></div>
      </div>
      <div id="bannerRight">
        <div class="ascii" id="weatherAscii"></div>
        <div class="summary" id="weatherSummary"></div>
      </div>
    </div>

    <!-- Optionally include your separate saints data via saintsData.js -->
    <script src="saintsData.js"></script>
    <script src="https://unpkg.com/textfit@2.3.1/textFit.min.js"></script>

    <script>
      /*********************
       * Configuration
       *********************/
      const slideDuration = 12000; // 12 seconds per slide.
      let slideCounter = 1; // Global slide counter

      const photoSlides = [
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2024/09/Wellington-de-Chasse.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2024/02/AFFICHE-BOUCHERIES-FINAL-Publication-Instagram-1.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2021/02/IMG_7968-2-edited-scaled.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2020/03/IMG_5239.png",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2019/03/100_0055_ws1036603047.jpg",
        },

        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2018/09/race-reconnue-zoom.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2017/03/Little-marcel-2.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2017/03/droppedImage.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2019/03/100_0055_ws1036603047.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2019/03/100_0055_ws1036603047.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2019/03/100_0055_ws1036603047.jpg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-1.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-2.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-3.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-4.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-5.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-6.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-7.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-8.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-9.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-10.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-11.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-12.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-13.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-14.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-15.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-16.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-17.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-18.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-19.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-20.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-21.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-22.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-23.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-24.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-25.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-26.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-28.jpeg",
        },
        {
          type: "image",
          content:
            "https://www.boucheriebocquet.fr/wp-content/uploads/2025/03/meatTop-29.jpeg",
        },
      ];

      // Example content slides. (You can add a "sidenote" property to text slides.)
      const textSlides = [
        {
          type: "text",
          title: "La Vitrine à Blagues",
          content: "Quelle est la différence entre un marin et un boucher?",
          sidenote: "Demandez la réponse à votre artisan!",
        },
        {
          type: "text",
          title: "Le Dico du Boucher",
          content:
            "Louchébem: son propre vocabulaire et ses règles de transformation.",
          sidenote: "Note additionnelle",
        },
        {
          type: "text",
          title: "La Vitrine à Blague",
          content: "Qui est l'ami du feu?",
          sidenote: "Indice: c'est un plat servi par votre boucher",
        },
        {
          type: "text",
          title: "À déguster cette semaine",
          content:
            "Nos tripes cuisinées, lasagnes, ou encore la tête de veau cuite",
          sidenote: "Indice: c'est un plat servi par votre boucher",
        },
        {
          type: "text",
          title: "",
          content:
            "La viande fabrique de l'amitié, du respect. C'est un produit si noble qu'il génère comme aucun autre de la complicité et de l'humanité entre les hommes.",
          sidenote: "",
        },
      ];

      // Screenshotmachine URL for weather slides.
      const screenshotMachineUrl =
        "https://api.screenshotmachine.com?key=c82f36" +
        "&url=" +
        encodeURIComponent(
          "https://www.meteoblue.com/fr/meteo/semaine/annecy_france_3037543?day=1"
        ) +
        "&dimension=1920x1080" +
        "&format=png" +
        "&click=" +
        encodeURIComponent(".fc-cta-consent") +
        "&delay=2000" +
        "&crop=" +
        encodeURIComponent("400,70,1000,460") +
        "&cacheLimit=0.5";

      /*********************
       * Slide Rendering Logic
       *********************/
      // Declare a global counter for photo slides.
      let photoGlobalCounter = 0;

      function getSlideData(counter) {
        const cycleIndex = (counter - 1) % 5;
        if (cycleIndex < 3) {
          // Instead of always mapping cycleIndex to 0,1,2,
          // use a global counter that advances each time a photo slide is needed.
          let photoIndex = photoGlobalCounter % photoSlides.length;
          photoGlobalCounter++;
          return photoSlides[photoIndex];
        } else if (cycleIndex === 3) {
          // For the text slide, cycle through textSlides.
          let textCycle = Math.floor((counter - 1) / 5);
          let textIndex = textCycle % textSlides.length;
          return textSlides[textIndex];
        } else {
          // For cycleIndex === 4, return the weather slide.
          return { type: "weather", content: screenshotMachineUrl };
        }
      }

      function renderSlide() {
        const slidesContainer = document.getElementById("slides");
        slidesContainer.innerHTML = "";
        const slideData = getSlideData(slideCounter);
        const slideEl = document.createElement("div");
        slideEl.classList.add("slide");

        // If this is an image slide, add a class for full-height image styling.
        if (slideData.type === "image") {
          slideEl.classList.add("image-slide");
        }

        if (slideData.type === "image" || slideData.type === "weather") {
          const imgEl = document.createElement("img");
          imgEl.src = slideData.content;
          slideEl.appendChild(imgEl);
        } else if (slideData.type === "text") {
          const titleEl = document.createElement("div");
          titleEl.classList.add("title");
          titleEl.textContent = slideData.title;

          const contentEl = document.createElement("div");
          contentEl.classList.add("content");

          // Create a child container with fixed dimensions
          const fitContainer = document.createElement("div");
          fitContainer.classList.add("fitme");
          // Set inline styles for fixed dimensions:
          fitContainer.style.width = "900px";
          fitContainer.style.height = "300px";
          fitContainer.style.overflow = "hidden";
          fitContainer.textContent = slideData.content;

          contentEl.appendChild(fitContainer);
          slideEl.appendChild(titleEl);
          slideEl.appendChild(contentEl);

          // Wait a brief moment to ensure the element is laid out,
          // then call textFit:
          setTimeout(() => {
            textFit(fitContainer, {
              alignHoriz: true,
              alignVert: true,
              multiLine: true,
              maxFontSize: 96,
            });
          }, 50);

          // If a sidenote exists, create and append it.
          if (slideData.sidenote) {
            const sidenoteEl = document.createElement("div");
            sidenoteEl.classList.add("sidenote");
            sidenoteEl.textContent = slideData.sidenote;
            slideEl.appendChild(sidenoteEl);
          }
        }

        slidesContainer.appendChild(slideEl);
        setTimeout(() => slideEl.classList.add("active"), 100);
      }

      function nextSlide() {
        slideCounter++;
        renderSlide();
      }

      function previousSlide() {
        slideCounter = slideCounter > 1 ? slideCounter - 1 : 1;
        renderSlide();
      }

      setInterval(nextSlide, slideDuration);
      renderSlide();

      document.addEventListener("keydown", function (event) {
        if (event.key === "ArrowRight") {
          nextSlide();
        } else if (event.key === "ArrowLeft") {
          previousSlide();
        }
      });

      /*********************
       * Banner Updates
       *********************/
      let lastBannerDateText = "";
      function updateBannerDateTime() {
        const bannerDateEl = document.getElementById("bannerDate");
        const bannerTimeEl = document.getElementById("bannerTime");

        const now = new Date();

        const dateOptions = { weekday: "long", month: "long", day: "numeric" };
        let dateStr = now.toLocaleDateString("fr-FR", dateOptions);
        dateStr = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

        // Use a 30-second cycle: first 20 seconds show the date, last 10 seconds show the saint.
        const cycle = Date.now() % 30000;
        let newText;
        if (cycle >= 20000) {
          newText = getSaintOfDay(); // Synchronous lookup from saintsData.
          newText = newText ? "Bonne fête " + newText + "!" : "";
        } else {
          newText = dateStr;
        }

        // Only animate if the text is changing.
        if (newText !== lastBannerDateText) {
          bannerDateEl.style.opacity = 0;
          setTimeout(() => {
            bannerDateEl.textContent = newText;
            bannerDateEl.style.opacity = 1;
            lastBannerDateText = newText;
          }, 500);
        }

        // Build time string with seconds.
        const hours = now.getHours().toString().padStart(2, "0");
        const minutes = now.getMinutes().toString().padStart(2, "0");
        // Create the blinking colon as an element.
        const blinkColon = document.createElement("span");
        blinkColon.classList.add("blinkColon");
        blinkColon.textContent = now.getSeconds() % 2 === 0 ? ":" : " ";

        // Clear any previous content and append time parts.
        bannerTimeEl.textContent = hours;
        bannerTimeEl.appendChild(blinkColon);
        bannerTimeEl.append(minutes);
      }
      setInterval(updateBannerDateTime, 1000);
      updateBannerDateTime();

      function getWindArrow(direction) {
        switch (direction) {
          case "N":
            return "↑";
          case "NNE":
            return "↑";
          case "NE":
            return "↗";
          case "ENE":
            return "↗";
          case "E":
            return "→";
          case "ESE":
            return "→";
          case "SE":
            return "↘";
          case "SSE":
            return "↘";
          case "S":
            return "↓";
          case "SSW":
            return "↓";
          case "SW":
            return "↙";
          case "WSW":
            return "↙";
          case "W":
            return "←";
          case "WNW":
            return "←";
          case "NW":
            return "↖";
          case "NNW":
            return "↖";
          default:
            return "";
        }
      }

      function updateBannerWeather() {
        const asciiDiv = document.getElementById("weatherAscii");
        const summaryDiv = document.getElementById("weatherSummary");

        fetch("https://wtttr.in/Annecy?lang=fr&0&M")
          .then((response) => response.text())
          .then((ascii) => {
            let pre = document.createElement("pre");
            pre.style.margin = "0";
            pre.style.fontFamily = "monospace";
            pre.textContent = ascii;
            asciiDiv.innerHTML = "";
            asciiDiv.appendChild(pre);
          })
          .catch((err) => {
            asciiDiv.textContent = "";
          });

        fetch("https://wttr.in/Annecy?format=j1")
          .then((response) => response.json())
          .then((data) => {
            const current = data.current_condition[0];
            const weather = data.weather[0];
            const astro = weather.astronomy[0];
            const temp = current.temp_C;
            const wind = current.windspeedKmph;
            const windDir = current.winddir16Point;
            const windArrow = getWindArrow(windDir);
            const minTemp = weather.mintempC;
            const maxTemp = weather.maxtempC;
            const moonIllum = astro.moon_illumination;
            const illum = parseInt(moonIllum, 10);
            let moonEmoji = "";
            if (illum < 25) {
              moonEmoji = "🌑";
            } else if (illum < 50) {
              moonEmoji = "🌒";
            } else if (illum < 75) {
              moonEmoji = "🌓";
            } else {
              moonEmoji = "🌔";
            }
            const summaryText = `Temp.: ${temp}°C <span class="tempRange">(${minTemp}° - ${maxTemp}°)</span><br>
<div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
  <span>Vent: <span class="arrow">${windArrow}</span> ${wind}<span class="small"> km/h ${windDir}</span></span>
  <span class="moon">${moonEmoji}</span>
</div>`;
            summaryDiv.innerHTML = summaryText;
          })
          .catch((err) => {
            summaryDiv.textContent = "";
          });
      }
      setInterval(updateBannerWeather, 60000);
      updateBannerWeather();

      /*********************
       * Saint-of-Day Lookup
       *********************/
      function getSaintOfDay() {
        const monthNames = [
          "january",
          "february",
          "march",
          "april",
          "may",
          "june",
          "july",
          "august",
          "september",
          "october",
          "november",
          "december",
        ];
        const now = new Date();
        const monthKey = monthNames[now.getMonth()];
        const dayIndex = now.getDate() - 1;
        if (saintsData[monthKey] && saintsData[monthKey][dayIndex]) {
          const entry = saintsData[monthKey][dayIndex];
          return entry[1] ? entry[0] : "";
        }
        return "";
      }
    </script>
  </body>
</html>
